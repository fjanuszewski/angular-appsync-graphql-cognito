{"version":3,"file":"photo-picker.component.core.js","sources":["../../../../../src/components/storage/photo-picker-component/photo-picker.component.core.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n// tslint:enable\n\nimport {\n\tComponent,\n\tInput,\n\tOutput,\n\tEventEmitter,\n\tOnInit,\n\tInject,\n} from '@angular/core';\nimport { AmplifyService } from '../../../providers/amplify.service';\n\nconst template = `\n<div class=\"amplify-photo-picker\">\n<div class=\"amplify-photo-picker-container\">\n  <div class=\"amplify-form-header\">Select Photos</div>\n  <div class=\"amplify-photo-picker-upload\" *ngIf=\"!hasPhoto\"></div>\n  <div class=\"amplify-photo-picker-preview\">\n    <img\n      class=\"amplify-photo-picker-preview\"\n      src=\"{{photoUrl}}\"\n      *ngIf=\"hasPhoto\"\n      (error)=\"onPhotoError()\"\n    />\n  </div>\n  <div class=\"amplify-upload-input\">\n    <input type=\"file\" \n      accept=\"image/*\"\n      (change)=\"pick($event)\"/>\n      <button \n        *ngIf=\"hasPhoto\" \n        class=\"amplify-form-button amplify-upload-button\" \n        (click)=\"uploadFile()\">\n        Upload Photo\n      </button>\n  </div>\n</div>\n<div class=\"amplify-alert\" *ngIf=\"errorMessage\">\n  <div class=\"amplify-alert-body\">\n    <span class=\"amplify-alert-icon\">&#9888;</span>\n    <div class=\"amplify-alert-message\">{{ errorMessage }}</div>\n    <a class=\"amplify-alert-close\" (click)=\"onAlertClose()\">&times;</a>\n  </div>\n</div>\n</div>\n`;\n\n@Component({\n\tselector: 'amplify-photo-picker-core',\n\ttemplate,\n})\nexport class PhotoPickerComponentCore implements OnInit {\n\tphotoUrl: string;\n\thasPhoto: boolean = false;\n\tuploading: boolean = false;\n\ts3ImageFile: any = null;\n\ts3ImagePath: string = '';\n\t_storageOptions: any = {};\n\terrorMessage: string;\n\tprotected logger: any;\n\n\tconstructor(@Inject(AmplifyService) public amplifyService: AmplifyService) {\n\t\tthis.logger = this.amplifyService.logger('PhotoPickerComponent');\n\t}\n\n\t@Input()\n\tset url(url: string) {\n\t\tthis.photoUrl = url;\n\t\tthis.hasPhoto = true;\n\t}\n\n\t@Input()\n\tset storageOptions(storageOptions: any) {\n\t\tthis._storageOptions = Object.assign(this._storageOptions, storageOptions);\n\t}\n\n\t@Input()\n\tset path(path: string) {\n\t\tthis.s3ImagePath = path;\n\t}\n\n\t@Input()\n\tset data(data: any) {\n\t\tthis.photoUrl = data.url;\n\t\tthis.s3ImagePath = data.path;\n\t\tthis._storageOptions = Object.assign(\n\t\t\tthis._storageOptions,\n\t\t\tdata.storageOptions\n\t\t);\n\t\tthis.hasPhoto = true;\n\t}\n\n\t@Output()\n\tpicked: EventEmitter<string> = new EventEmitter<string>();\n\n\t@Output()\n\tloaded: EventEmitter<string> = new EventEmitter<string>();\n\n\t@Output()\n\tuploaded: EventEmitter<Object> = new EventEmitter<Object>();\n\n\tngOnInit() {\n\t\tif (!this.amplifyService.storage()) {\n\t\t\tthrow new Error(\n\t\t\t\t'Storage module not registered on AmplifyService provider'\n\t\t\t);\n\t\t}\n\t}\n\n\tpick(evt) {\n\t\tconst file = evt.target.files[0];\n\t\tif (!file) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._storageOptions.contentType) {\n\t\t\tthis._storageOptions.contentType = file.type;\n\t\t}\n\t\tconst { name, size, type } = file;\n\t\tthis.picked.emit(file);\n\n\t\tthis.s3ImagePath = `${this.s3ImagePath}/${file.name}`;\n\t\tthis.s3ImageFile = file;\n\t\tconst that = this;\n\t\tconst reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tconst target: any = e.target;\n\t\t\tconst url = target.result;\n\t\t\tthat.photoUrl = url;\n\t\t\tthat.hasPhoto = true;\n\t\t\tthat.loaded.emit(url);\n\t\t};\n\t\treader.readAsDataURL(file);\n\t}\n\n\tuploadFile() {\n\t\tthis.uploading = true;\n\t\tthis.amplifyService\n\t\t\t.storage()\n\t\t\t.put(this.s3ImagePath, this.s3ImageFile, this._storageOptions)\n\t\t\t.then(result => {\n\t\t\t\tthis.uploaded.emit(result);\n\t\t\t\tthis.completeFileUpload();\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tthis.completeFileUpload(error);\n\t\t\t});\n\t}\n\n\tcompleteFileUpload(error?: any) {\n\t\tif (error) {\n\t\t\treturn this._setError(error);\n\t\t}\n\t\tthis.s3ImagePath = '';\n\t\tthis.photoUrl = null;\n\t\tthis.s3ImageFile = null;\n\t\tthis.uploading = false;\n\t}\n\n\tonPhotoError() {\n\t\tthis.hasPhoto = false;\n\t}\n\n\tonAlertClose() {\n\t\tthis._setError(null);\n\t}\n\n\t_setError(err) {\n\t\tif (!err) {\n\t\t\tthis.errorMessage = null;\n\t\t\treturn;\n\t\t}\n\t\tthis.errorMessage = err.message || err;\n\t}\n}\n"]}