{"version":3,"file":"chatbot.component.core.js","sources":["../../../../../src/components/interactions/chatbot/chatbot.component.core.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n// tslint:enable\n\nimport {\n\tComponent,\n\tInput,\n\tOutput,\n\tEventEmitter,\n\tOnInit,\n\tChangeDetectorRef,\n\tInject,\n} from '@angular/core';\nimport { AmplifyService } from '../../../providers/amplify.service';\nimport { isUndefined } from 'util';\nimport { chatBot } from '../../../assets/data-test-attributes';\nrequire('./aws-lex-audio.js');\n\nconst template = `\n<div class=\"amplify-interactions\">\n\t<div class=\"amplify-interactions-container\">\n\t\t<div class=\"amplify-form-container\">\n\t\t\t<div class=\"amplify-form-row\">\n\t\t\t\t<div class=\"amplify-interactions-conversation\">\n\t\t\t\t\t<div *ngFor=\"let message of messages\">\n\t\t\t\t\t\t<div class=\"amplify-interactions-input\">{{message.me}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-input-timestamp\">{{message.meSentTime}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-response\">{{message.bot}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-response-timestamp\">{{message.botSentTime}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"amplify-interactions-actions\">\n\t\t\t\t<input #inputValue\n\t\t\t\t\tdata-test=\"${chatBot.messageInput}\"\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass=\"amplify-form-input\"\n\t\t\t\t\tplaceholder=\"{{currentVoiceState}}\"\n\t\t\t\t\t[value]=\"inputText\"\n\t\t\t\t\t(keyup.enter)=\"onSubmit(inputValue.value)\"\n\t\t\t\t\t(change)=\"onInputChange($event.target.value)\"\n\t\t\t\t\t[disabled]=\"inputDisabled\"\n\t\t\t\t\t*ngIf=\"textEnabled\">\n\t\t\t\t<input #inputValue\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass=\"amplify-form-input\"\n\t\t\t\t\tplaceholder=\"{{currentVoiceState}}\"\n\t\t\t\t\t[disabled]=\"!textEnabled\"\n\t\t\t\t\t*ngIf=\"!textEnabled\">\n\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t*ngIf=\"voiceEnabled\"\n\t\t\t\t\tng-style=\"{float: 'right'}\"\n\t\t\t\t\t(click)=\"micButtonHandler()\"\n\t\t\t\t\t[disabled]=\"micButtonDisabled\"\n\t\t\t\t>\n\t\t\t\t\t{{micText}}\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t*ngIf=\"textEnabled\"\n\t\t\t\t\tng-style=\"{float: 'right'}\"\n\t\t\t\t\tclass=\"amplify-interactions-button\"\n\t\t\t\t\t[disabled]=\"inputDisabled\"\n\t\t\t\t\tng-click=\"!inputDisabled || onSubmit(inputValue.value)\"\n\t\t\t\t></button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n`;\ndeclare var LexAudio: any;\n\nconst STATES = {\n\tINITIAL: { MESSAGE: 'Type your message or click  🎤', ICON: '🎤' },\n\tLISTENING: { MESSAGE: 'Listening... click 🔴 again to cancel', ICON: '🔴' },\n\tSENDING: { MESSAGE: 'Please wait...', ICON: '🔊' },\n\tSPEAKING: { MESSAGE: 'Speaking...', ICON: '...' },\n};\n\nconst defaultVoiceConfig = {\n\tsilenceDetectionConfig: {\n\t\ttime: 2000,\n\t\tamplitude: 0.2,\n\t},\n};\n\n@Component({\n\tselector: 'amplify-interactions-core',\n\ttemplate,\n})\nexport class ChatbotComponentCore implements OnInit {\n\terrorMessage: string;\n\tinputText: string = '';\n\tbotName: string;\n\tchatTitle: string;\n\tclearComplete: boolean = false;\n\tmessages: any = [];\n\tcompletions: any = {};\n\tcurrentVoiceState: string = STATES.INITIAL.MESSAGE;\n\tinputDisabled: boolean = false;\n\tmicText: string = STATES.INITIAL.ICON;\n\tvoiceConfig: any = defaultVoiceConfig;\n\tcontinueConversation: boolean = false;\n\tmicButtonDisabled: boolean = false;\n\taudioInput: any;\n\tlexResponse: any;\n\tconversationModeOn: boolean = false;\n\tref: ChangeDetectorRef;\n\tvoiceEnabled: boolean = false;\n\ttextEnabled: boolean = true;\n\taudioControl: any;\n\tprotected logger;\n\n\t@Output()\n\tcomplete: EventEmitter<string> = new EventEmitter<string>();\n\n\tconstructor(\n\t\tref: ChangeDetectorRef,\n\t\t@Inject(AmplifyService) public amplifyService: AmplifyService\n\t) {\n\t\tthis.ref = ref;\n\t\tthis.continueConversation = false;\n\t\tthis.logger = this.amplifyService.logger('ChatbotComponent');\n\t}\n\n\t@Input()\n\tset data(data: any) {\n\t\tthis.botName = data.bot;\n\t\tthis.chatTitle = data.title;\n\t\tthis.clearComplete = data.clearComplete;\n\t\tthis.conversationModeOn = isUndefined(data.conversationModeOn)\n\t\t\t? false\n\t\t\t: data.conversationModeOn;\n\t\tthis.voiceEnabled = isUndefined(data.voiceEnabled)\n\t\t\t? false\n\t\t\t: data.voiceEnabled;\n\t\tthis.textEnabled = isUndefined(data.textEnabled) ? true : data.textEnabled;\n\t\tthis.voiceConfig = data.voiceConfig || this.voiceConfig;\n\t\tthis.performOnComplete = this.performOnComplete.bind(this);\n\t\tthis.amplifyService\n\t\t\t.interactions()\n\t\t\t.onComplete(this.botName, this.performOnComplete);\n\n\t\tif (!this.textEnabled && this.voiceEnabled) {\n\t\t\tthis.currentVoiceState = 'Click the mic button';\n\t\t\tSTATES.INITIAL.MESSAGE = 'Click the mic button';\n\t\t}\n\n\t\tif (!this.voiceEnabled && this.textEnabled) {\n\t\t\tthis.currentVoiceState = 'Type a message';\n\t\t\tSTATES.INITIAL.MESSAGE = 'Type a message';\n\t\t}\n\n\t\tif (this.voiceEnabled) {\n\t\t\tthis.audioControl = new LexAudio.audioControl();\n\t\t}\n\t}\n\n\t@Input()\n\tset bot(botName: string) {\n\t\tthis.botName = botName;\n\t\tthis.performOnComplete = this.performOnComplete.bind(this);\n\t\tthis.amplifyService\n\t\t\t.interactions()\n\t\t\t.onComplete(botName, this.performOnComplete);\n\t}\n\n\t@Input()\n\tset title(title: string) {\n\t\tthis.chatTitle = title;\n\t}\n\n\t@Input()\n\tset clearOnComplete(clearComplete: boolean) {\n\t\tthis.clearComplete = clearComplete;\n\t}\n\n\tngOnInit() {\n\t\tif (!this.amplifyService.interactions()) {\n\t\t\tthrow new Error(\n\t\t\t\t'Interactions module not registered on AmplifyService provider'\n\t\t\t);\n\t\t}\n\t}\n\n\tperformOnComplete(evt) {\n\t\tthis.complete.emit(evt);\n\t\tif (this.clearComplete) {\n\t\t\tthis.messages = [];\n\t\t}\n\t}\n\n\tonInputChange(value: string) {\n\t\tthis.inputText = value;\n\t}\n\n\tonSubmit(e) {\n\t\tif (!this.inputText) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = {\n\t\t\tme: this.inputText,\n\t\t\tmeSentTime: new Date().toLocaleTimeString(),\n\t\t\tbot: '',\n\t\t\tbotSentTime: '',\n\t\t};\n\t\tthis.amplifyService\n\t\t\t.interactions()\n\t\t\t.send(this.botName, this.inputText)\n\t\t\t.then((response: any) => {\n\t\t\t\tthis.inputText = '';\n\t\t\t\tmessage.bot = response.message;\n\t\t\t\tmessage.botSentTime = new Date().toLocaleTimeString();\n\t\t\t\tthis.messages.push(message);\n\t\t\t})\n\t\t\t.catch(error => this.logger.error(error));\n\t}\n\n\tonSilenceHandler = () => {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\t\tthis.audioControl.exportWAV(blob => {\n\t\t\tthis.currentVoiceState = STATES.SENDING.MESSAGE;\n\t\t\tthis.audioInput = blob;\n\t\t\tthis.micText = STATES.SENDING.ICON;\n\t\t\tthis.micButtonDisabled = true;\n\t\t\tthis.lexResponseHandler();\n\t\t});\n\t\tthis.ref.detectChanges();\n\t};\n\n\treset() {\n\t\tthis.audioControl.clear();\n\t\tthis.inputText = '';\n\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\tthis.inputDisabled = false;\n\t\tthis.micText = STATES.INITIAL.ICON;\n\t\tthis.continueConversation = false;\n\t\tthis.micButtonDisabled = false;\n\t\tthis.ref.detectChanges();\n\t}\n\n\tonError(error) {\n\t\tthis.logger.error(error);\n\t}\n\n\tasync lexResponseHandler() {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst interactionsMessage = {\n\t\t\tcontent: this.audioInput,\n\t\t\toptions: {\n\t\t\t\tmessageType: 'voice',\n\t\t\t},\n\t\t};\n\n\t\tconst response = await this.amplifyService\n\t\t\t.interactions()\n\t\t\t.send(this.botName, interactionsMessage);\n\n\t\tthis.lexResponse = response;\n\t\tthis.currentVoiceState = STATES.SPEAKING.MESSAGE;\n\t\tthis.micText = STATES.SPEAKING.ICON;\n\t\tthis.micButtonDisabled = true;\n\n\t\tconst message = {\n\t\t\tme: this.lexResponse.inputTranscript,\n\t\t\tmeSentTime: new Date().toLocaleTimeString(),\n\t\t\tbot: '',\n\t\t\tbotSentTime: '',\n\t\t};\n\n\t\tthis.inputText = '';\n\t\tmessage.bot = this.lexResponse.message;\n\t\tmessage.botSentTime = new Date().toLocaleTimeString();\n\t\tthis.messages.push(message);\n\t\tthis.doneSpeakingHandler();\n\t\tthis.ref.detectChanges();\n\t}\n\n\tdoneSpeakingHandler() {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.lexResponse.contentType === 'audio/mpeg') {\n\t\t\tthis.audioControl.play(this.lexResponse.audioStream, () => {\n\t\t\t\tif (\n\t\t\t\t\tthis.lexResponse.dialogState === 'ReadyForFulfillment' ||\n\t\t\t\t\tthis.lexResponse.dialogState === 'Fulfilled' ||\n\t\t\t\t\tthis.lexResponse.dialogState === 'Failed' ||\n\t\t\t\t\t!this.conversationModeOn\n\t\t\t\t) {\n\t\t\t\t\tthis.inputDisabled = false;\n\t\t\t\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\t\t\t\tthis.micText = STATES.INITIAL.ICON;\n\t\t\t\t\tthis.micButtonDisabled = false;\n\t\t\t\t\tthis.continueConversation = false;\n\t\t\t\t\tthis.ref.detectChanges();\n\t\t\t\t} else {\n\t\t\t\t\tthis.currentVoiceState = STATES.LISTENING.MESSAGE;\n\t\t\t\t\tthis.micText = STATES.LISTENING.ICON;\n\t\t\t\t\tthis.micButtonDisabled = false;\n\t\t\t\t\tthis.audioControl.startRecording(\n\t\t\t\t\t\tthis.onSilenceHandler,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tthis.voiceConfig.silenceDetectionConfig\n\t\t\t\t\t);\n\t\t\t\t\tthis.ref.detectChanges();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.inputDisabled = false;\n\t\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\t\tthis.micText = STATES.INITIAL.ICON;\n\t\t\tthis.micButtonDisabled = false;\n\t\t\tthis.continueConversation = false;\n\t\t\tthis.ref.detectChanges();\n\t\t}\n\t}\n\n\tasync micButtonHandler() {\n\t\tif (this.continueConversation) {\n\t\t\tthis.reset();\n\t\t\tthis.ref.detectChanges();\n\t\t} else {\n\t\t\tthis.inputDisabled = true;\n\t\t\tthis.continueConversation = true;\n\t\t\tthis.currentVoiceState = STATES.LISTENING.MESSAGE;\n\t\t\tthis.micText = STATES.LISTENING.ICON;\n\t\t\tthis.micButtonDisabled = false;\n\t\t\tthis.audioControl.startRecording(\n\t\t\t\tthis.onSilenceHandler,\n\t\t\t\tnull,\n\t\t\t\tthis.voiceConfig.silenceDetectionConfig\n\t\t\t);\n\t\t\tthis.ref.detectChanges();\n\t\t}\n\t}\n}\n"]}